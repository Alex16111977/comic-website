<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢–µ—Å—Ç localStorage –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            font-size: 1.8em;
            margin-bottom: 10px;
            color: #1f2937;
        }
        
        .device-info {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 0.9em;
        }
        
        .device-info div {
            padding: 5px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .device-info div:last-child {
            border-bottom: none;
        }
        
        .test-section {
            margin: 25px 0;
            padding: 20px;
            background: #fafafa;
            border-radius: 10px;
            border: 2px solid #e5e7eb;
        }
        
        .test-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #4b5563;
            font-size: 1.1em;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        button:hover {
            background: #5a67d8;
        }
        
        button.success {
            background: #10b981;
        }
        
        button.danger {
            background: #ef4444;
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            font-family: monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .result.success {
            background: #d1fae5;
            border-color: #10b981;
        }
        
        .result.error {
            background: #fee2e2;
            border-color: #ef4444;
        }
        
        .result.info {
            background: #dbeafe;
            border-color: #3b82f6;
        }
        
        .word-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .word-card:active {
            transform: scale(0.98);
            background: #f9fafb;
        }
        
        .word-info {
            flex: 1;
        }
        
        .word-german {
            font-size: 1.2em;
            font-weight: bold;
            color: #1f2937;
        }
        
        .word-russian {
            color: #6b7280;
            margin-top: 5px;
        }
        
        .remove-btn {
            background: #ef4444;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
        }
        
        .status.ok {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status.warning {
            background: #fed7aa;
            color: #92400e;
        }
        
        /* –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
                border-radius: 15px;
            }
            
            h1 {
                font-size: 1.5em;
            }
            
            button {
                padding: 10px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ –¢–µ—Å—Ç localStorage</h1>
        <p style="color: #6b7280; margin-bottom: 20px;">
            –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–ª–æ–≤–∞—Ä—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
        </p>
        
        <div class="device-info">
            <div><strong>User Agent:</strong> <span id="userAgent"></span></div>
            <div><strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> <span id="platform"></span></div>
            <div><strong>–†–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞:</strong> <span id="screenSize"></span></div>
            <div><strong>localStorage:</strong> <span id="localStorageStatus"></span></div>
            <div><strong>–í—Ä–µ–º—è:</strong> <span id="currentTime"></span></div>
        </div>
        
        <!-- –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ localStorage -->
        <div class="test-section">
            <div class="test-title">üìù –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ localStorage</div>
            <button onclick="testLocalStorage()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
            <button onclick="clearLocalStorage()" class="danger">–û—á–∏—Å—Ç–∏—Ç—å localStorage</button>
            <div id="test1Result" class="result" style="display:none;"></div>
        </div>
        
        <!-- –¢–µ—Å—Ç 2: –†–∞–±–æ—Ç–∞ —Å–æ —Å–ª–æ–≤–∞—Ä–µ–º -->
        <div class="test-section">
            <div class="test-title">üìö –¢–µ—Å—Ç 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ–≤ –≤ —Å–ª–æ–≤–∞—Ä—å</div>
            <button onclick="addTestWord()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–ª–æ–≤–æ</button>
            <button onclick="showWords()" class="success">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–ª–æ–≤–∞</button>
            <div id="wordsList"></div>
            <div id="test2Result" class="result" style="display:none;"></div>
        </div>
        
        <!-- –¢–µ—Å—Ç 3: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏ -->
        <div class="test-section">
            <div class="test-title">üîÑ –¢–µ—Å—Ç 3: –°–æ–±—ã—Ç–∏—è storage</div>
            <button onclick="testStorageEvents()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è</button>
            <div id="test3Result" class="result" style="display:none;"></div>
        </div>
        
        <!-- –¢–µ—Å—Ç 4: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -->
        <div class="test-section">
            <div class="test-title">‚ö° –¢–µ—Å—Ç 4: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ª–∏–º–∏—Ç—ã</div>
            <button onclick="testPerformance()">–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</button>
            <div id="test4Result" class="result" style="display:none;"></div>
        </div>
        
        <!-- –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å -->
        <div id="generalStatus" class="status" style="display:none;"></div>
    </div>

    <script>
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const STORAGE_KEY = 'liraJourney:reviewQueue';
        const TEST_KEY = 'test_localStorage_mobile';
        
        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
        function showDeviceInfo() {
            document.getElementById('userAgent').textContent = navigator.userAgent;
            document.getElementById('platform').textContent = navigator.platform || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            document.getElementById('screenSize').textContent = `${window.innerWidth} x ${window.innerHeight}`;
            
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                document.getElementById('localStorageStatus').textContent = '‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω';
                document.getElementById('localStorageStatus').style.color = '#10b981';
            } catch (e) {
                document.getElementById('localStorageStatus').textContent = '‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                document.getElementById('localStorageStatus').style.color = '#ef4444';
            }
            
            document.getElementById('currentTime').textContent = new Date().toLocaleString('ru-RU');
        }
        
        // –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ localStorage
        function testLocalStorage() {
            const resultDiv = document.getElementById('test1Result');
            resultDiv.style.display = 'block';
            let results = [];
            
            try {
                // –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏
                const testData = {
                    timestamp: Date.now(),
                    device: navigator.userAgent,
                    random: Math.random()
                };
                
                localStorage.setItem(TEST_KEY, JSON.stringify(testData));
                results.push('[OK] –ó–∞–ø–∏—Å—å –≤ localStorage');
                
                // –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è
                const readData = localStorage.getItem(TEST_KEY);
                if (readData) {
                    const parsed = JSON.parse(readData);
                    if (parsed.timestamp === testData.timestamp) {
                        results.push('[OK] –ß—Ç–µ–Ω–∏–µ –∏–∑ localStorage');
                        results.push('[OK] –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                    } else {
                        results.push('[ERROR] –î–∞–Ω–Ω—ã–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã');
                    }
                } else {
                    results.push('[ERROR] –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ');
                }
                
                // –¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è
                localStorage.removeItem(TEST_KEY);
                const afterDelete = localStorage.getItem(TEST_KEY);
                if (!afterDelete) {
                    results.push('[OK] –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ localStorage');
                } else {
                    results.push('[ERROR] –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–æ—Ç—ã
                const storageSize = new Blob(Object.values(localStorage)).size;
                results.push(`[INFO] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: ${(storageSize / 1024).toFixed(2)} KB`);
                
                resultDiv.className = 'result success';
                resultDiv.textContent = results.join('\n');
                
                updateStatus('ok', 'localStorage —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ');
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `[ERROR] ${error.name}: ${error.message}`;
                
                updateStatus('error', 'localStorage –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!');
            }
        }
        
        // –¢–µ—Å—Ç 2: –†–∞–±–æ—Ç–∞ —Å–æ —Å–ª–æ–≤–∞—Ä–µ–º
        function addTestWord() {
            try {
                const words = getWords();
                const newWord = {
                    id: `word_${Date.now()}`,
                    word: `Test ${words.length + 1}`,
                    translation: `–¢–µ—Å—Ç ${words.length + 1}`,
                    transcription: `[test ${words.length + 1}]`,
                    characterId: 'test_character',
                    emoji: 'üéØ',
                    sentence: 'Das ist ein Test',
                    sentenceTranslation: '–≠—Ç–æ —Ç–µ—Å—Ç'
                };
                
                words.push(newWord);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(words));
                
                showWords();
                
                const resultDiv = document.getElementById('test2Result');
                resultDiv.style.display = 'block';
                resultDiv.className = 'result success';
                resultDiv.textContent = `[OK] –°–ª–æ–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ\n[OK] –í—Å–µ–≥–æ —Å–ª–æ–≤: ${words.length}`;
                
            } catch (error) {
                const resultDiv = document.getElementById('test2Result');
                resultDiv.style.display = 'block';
                resultDiv.className = 'result error';
                resultDiv.textContent = `[ERROR] –ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ: ${error.message}`;
            }
        }
        
        function getWords() {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                return data ? JSON.parse(data) : [];
            } catch (e) {
                return [];
            }
        }
        
        function showWords() {
            const words = getWords();
            const container = document.getElementById('wordsList');
            
            if (words.length === 0) {
                container.innerHTML = '<div style="padding: 20px; text-align: center; color: #9ca3af;">–°–ª–æ–≤–∞—Ä—å –ø—É—Å—Ç</div>';
            } else {
                container.innerHTML = words.map(word => `
                    <div class="word-card">
                        <div class="word-info">
                            <div class="word-german">${word.emoji || 'üìù'} ${word.word || '–°–ª–æ–≤–æ'}</div>
                            <div class="word-russian">${word.translation || '–ü–µ—Ä–µ–≤–æ–¥'}</div>
                        </div>
                        <button class="remove-btn" onclick="removeWord('${word.id || word.word}')">√ó</button>
                    </div>
                `).join('');
            }
        }
        
        function removeWord(wordId) {
            let words = getWords();
            words = words.filter(w => w.id !== wordId && w.word !== wordId);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(words));
            showWords();
        }
        
        // –¢–µ—Å—Ç 3: –°–æ–±—ã—Ç–∏—è storage
        function testStorageEvents() {
            const resultDiv = document.getElementById('test3Result');
            resultDiv.style.display = 'block';
            
            let eventFired = false;
            
            const listener = (e) => {
                if (e.key === 'test_storage_event') {
                    eventFired = true;
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `[OK] –°–æ–±—ã—Ç–∏–µ storage –ø–æ–ª—É—á–µ–Ω–æ\n[OK] –ö–ª—é—á: ${e.key}\n[OK] –ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${e.newValue}`;
                    window.removeEventListener('storage', listener);
                }
            };
            
            window.addEventListener('storage', listener);
            
            // –°–∏–º—É–ª—è—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ
            setTimeout(() => {
                localStorage.setItem('test_storage_event', Date.now());
                
                setTimeout(() => {
                    if (!eventFired) {
                        resultDiv.className = 'result warning';
                        resultDiv.textContent = '[WARNING] –°–æ–±—ã—Ç–∏—è storage –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏\n[INFO] –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –æ–¥–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏';
                    }
                    localStorage.removeItem('test_storage_event');
                }, 1000);
            }, 100);
        }
        
        // –¢–µ—Å—Ç 4: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
        function testPerformance() {
            const resultDiv = document.getElementById('test4Result');
            resultDiv.style.display = 'block';
            
            try {
                const results = [];
                
                // –¢–µ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–∏
                const writeStart = performance.now();
                for (let i = 0; i < 100; i++) {
                    localStorage.setItem(`perf_test_${i}`, JSON.stringify({data: 'test'}));
                }
                const writeTime = performance.now() - writeStart;
                results.push(`[OK] –ó–∞–ø–∏—Å—å 100 —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ${writeTime.toFixed(2)}ms`);
                
                // –¢–µ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ —á—Ç–µ–Ω–∏—è
                const readStart = performance.now();
                for (let i = 0; i < 100; i++) {
                    localStorage.getItem(`perf_test_${i}`);
                }
                const readTime = performance.now() - readStart;
                results.push(`[OK] –ß—Ç–µ–Ω–∏–µ 100 —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ${readTime.toFixed(2)}ms`);
                
                // –û—á–∏—Å—Ç–∫–∞
                for (let i = 0; i < 100; i++) {
                    localStorage.removeItem(`perf_test_${i}`);
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
                try {
                    const bigData = 'x'.repeat(1024 * 1024); // 1MB
                    localStorage.setItem('size_test', bigData);
                    localStorage.removeItem('size_test');
                    results.push('[OK] –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º 1MB –¥–∞–Ω–Ω—ã—Ö');
                } catch (e) {
                    results.push('[WARNING] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ < 1MB');
                }
                
                // –û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                if (writeTime < 50 && readTime < 50) {
                    results.push('[OK] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç–ª–∏—á–Ω–∞—è');
                } else if (writeTime < 100 && readTime < 100) {
                    results.push('[OK] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ö–æ—Ä–æ—à–∞—è');
                } else {
                    results.push('[WARNING] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∏–∑–∫–∞—è');
                }
                
                resultDiv.className = 'result success';
                resultDiv.textContent = results.join('\n');
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `[ERROR] –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`;
            }
        }
        
        // –û—á–∏—Å—Ç–∫–∞ localStorage
        function clearLocalStorage() {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage?')) {
                localStorage.clear();
                showWords();
                updateStatus('warning', 'localStorage –æ—á–∏—â–µ–Ω');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(type, message) {
            const status = document.getElementById('generalStatus');
            status.style.display = 'block';
            status.className = `status ${type}`;
            status.textContent = message;
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            showDeviceInfo();
            showWords();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
            setInterval(() => {
                document.getElementById('currentTime').textContent = new Date().toLocaleString('ru-RU');
            }, 1000);
            
            // –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ–±—ã—Ç–∏–π storage
            window.addEventListener('storage', (e) => {
                if (e.key === STORAGE_KEY) {
                    console.log('Storage event detected:', e);
                    showWords();
                }
            });
        });
    </script>
</body>
</html>
