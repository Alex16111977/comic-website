<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K√∂nig Lear - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="static/css/index.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üëë –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ö–æ—Ä–æ–ª—è –õ–∏—Ä–∞</h1>
            <p class="subtitle">
                –ò–∑—É—á–∞–µ–º –Ω–µ–º–µ—Ü–∫–∏–π —á–µ—Ä–µ–∑ —Ç—Ä–∞–≥–µ–¥–∏—é –®–µ–∫—Å–ø–∏—Ä–∞<br>
                –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ —Å {{ character_count }} –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏
            </p>
            <div class="stats">
                <div class="stat">
                    <span class="stat-number">{{ character_count }}</span>
                    <span class="stat-label">–ü–µ—Ä—Å–æ–Ω–∞–∂–µ–π</span>
                </div>
                <div class="stat">
                    <span class="stat-number">{{ phase_total }}</span>
                    <span class="stat-label">–§–∞–∑—ã –ø—É—Ç–∏</span>
                </div>
                <div class="stat">
                    <span class="stat-number">{{ vocabulary_total }}</span>
                    <span class="stat-label">–°–ª–æ–≤ B1</span>
                </div>
            </div>
        </header>

        <!-- –†–∞–∑–¥–µ–ª "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è" —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ -->
        <section class="review-section">
            <div class="review-header">
                <h2>–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è</h2>
                <p>–ü–æ–¥–±–æ—Ä–∫–∞ —Å–ª–æ–≤ –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç –æ—Å–≤–µ–∂–∏—Ç—å</p>
            </div>
            <div id="review-grid" class="review-grid">
                <p class="review-empty">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π</p>
            </div>
            <button class="clear-all-btn" onclick="StudyManager.clearAll()" style="display:none;">
                –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
            </button>
        </section>

        <div class="characters-grid">
            {% for card in cards %}
            <div class="character-card" data-character="{{ card.id }}">
                <div class="card-icon">{{ card.icon }}</div>
                <h3>{{ card.name }}</h3>
                <p class="role">{{ card.role }}</p>
                <div class="phase-count">{{ card.phase_count }} —Ñ–∞–∑ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</div>
                <a href="{{ card.url }}" class="journey-link">–ù–∞—á–∞—Ç—å –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ ‚Üí</a>
            </div>
            {% endfor %}
        </div>
    </div>
    <script>
    // StudyManager –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å localStorage –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    const StudyManager = {
        STORAGE_KEY: 'liraJourney:studyWords',
        MAX_WORDS: 5,
        
        getWords() {
            try {
                const data = localStorage.getItem(this.STORAGE_KEY);
                return data ? JSON.parse(data) : [];
            } catch(e) {
                return [];
            }
        },
        
        removeWord(wordId) {
            let words = this.getWords();
            words = words.filter(w => w.id !== wordId);
            localStorage.setItem(this.STORAGE_KEY, JSON.stringify(words));
            this.updateDisplay();
        },
        
        clearAll() {
            localStorage.setItem(this.STORAGE_KEY, JSON.stringify([]));
            this.updateDisplay();
        },
        
        updateDisplay() {
            const container = document.getElementById('review-grid');
            const clearBtn = document.querySelector('.clear-all-btn');
            const words = this.getWords();
            
            if (words.length === 0) {
                container.innerHTML = '<p class="review-empty">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π</p>';
                clearBtn.style.display = 'none';
                return;
            }
            
            clearBtn.style.display = 'block';
            
            // –°–æ–∑–¥–∞—ë–º –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
            container.innerHTML = words.map(w => {
                const wordId = w.id || w.word.replace(/\s+/g, '_').toLowerCase();
                const emoji = w.emoji || 'üìñ';
                const level = w.level || 'A2';
                const theme = w.theme || 'royal';
                const example = w.example || `¬´${w.originalSentence || '...'}\u00bb`;
                
                return `
                <article class="review-card" data-word-id="${wordId}">
                    <button class="review-remove" type="button" onclick="StudyManager.removeWord('${wordId}')"
                        aria-label="–£–±—Ä–∞—Ç—å ¬´${w.word}\u00bb –∏–∑ –æ—á–µ—Ä–µ–¥–∏">
                        –£–±—Ä–∞—Ç—å
                    </button>
                    <div class="review-card-header">
                        <div class="review-icon">${emoji}</div>
                        <div class="review-title">
                            <span class="review-word">${w.word}</span>
                            <span class="review-translation">${w.translation}</span>
                        </div>
                    </div>
                    ${example ? `<p class="review-example">${example}</p>` : ''}
                    <div class="review-meta">
                        <span class="review-tag">–£—Ä–æ–≤–µ–Ω—å ${level}</span>
                        <span class="review-tag">–¢–µ–º–∞: ${theme}</span>
                        ${w.transcription ? `<span class="review-tag">${w.transcription}</span>` : ''}
                    </div>
                    <a href="training.html?word=${wordId}" class="review-link" aria-label="–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–ª–æ–≤–∞ ${w.word}">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ ‚Üí</a>
                </article>
                `;
            }).join('');
        }
    };
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', () => {
        StudyManager.updateDisplay();
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ localStorage –∏–∑ –¥—Ä—É–≥–∏—Ö –≤–∫–ª–∞–¥–æ–∫
    window.addEventListener('storage', (e) => {
        if (e.key === StudyManager.STORAGE_KEY) {
            StudyManager.updateDisplay();
        }
    });
    </script>
</body>
</html>
